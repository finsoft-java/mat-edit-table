<div class="button_style_cassettiere">
    <button *ngIf="csvExportEnabled" mat-raised-button color="secondary" style="float: right;margin: 0px 0px 0px 0px;" [disabled]="!buttonsEnabled" (click)="exportCsv()">{{labels.exportCsv}}</button>
    <button *ngIf="xlsxExportEnabled" mat-raised-button color="secondary" style="float: right;margin: 0px 10px 0px 0px;" [disabled]="!buttonsEnabled" (click)="exportXlsx()">{{labels.exportXlsx}}</button>
    <button *ngIf="editable" mat-raised-button color="primary" style="float: right;margin: 0px 10px 0px 0px;" [disabled]="!buttonsEnabled || creating" (click)="beginCreate()">{{labels.add}}</button>
    <button mat-raised-button color="primary" style="float: right;margin: 0px 10px 0px 0px;" [disabled]="!buttonsEnabled || creating" (click)="refresh()">{{labels.refresh}}</button>
  </div>

  <ng-content></ng-content>

  <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" style="width:100%" id="edittable" #maintable>
      <ng-container matColumnDef="{{col.data}}" *ngFor="let col of columns">
        <th mat-header-cell *matHeaderCellDef>
          {{col.title}}
        </th>
        <td mat-cell *matCellDef="let row; let rowNum = index;" [style.width]="col.width" [ngStyle]="getConditionalFormatting(row)">

          <div *ngIf="rowNum !== editRowNumber">
              <div *ngIf="col.data === ACTIONS_INDEX; spanHeader" >
                <button mat-raised-button color="primary" style="margin-right:15px;" [disabled]="!buttonsEnabled" [title]="labels.edit" (click)="beginEdit(rowNum)"><mat-icon>edit</mat-icon></button>
                <button mat-raised-button color="warn" [disabled]="!buttonsEnabled" [title]="labels.delete" (click)="deleteRow(rowNum)"><mat-icon>delete</mat-icon></button>
              </div>
              <span #spanHeader>
                {{ renderCell(col, row, rowNum) }}
              </span>
            </div>
            <div *ngIf="rowNum === editRowNumber" #tableFormRow>
              <div *ngIf="col.data === ACTIONS_INDEX; else dataField">
                  <button mat-raised-button color="primary" style="margin-right:15px;" [disabled]="!buttonsEnabled" [title]="labels.save" (click)="saveRow(rowNum)"><mat-icon>save</mat-icon></button>
                  <button mat-raised-button color="secondary" [disabled]="!buttonsEnabled" [title]="labels.undo" (click)="undoChange(rowNum);"><mat-icon>undo</mat-icon></button>
                  <button *ngFor="let a of actions" mat-raised-button color="a.color" [disabled]="!buttonsEnabled" [title]="a.title" (click)="a.onClick(row)"><mat-icon>{{a.icon}}</mat-icon></button>
              </div>
              <ng-template #dataField>
                <mat-form-field *ngIf="col.type !== 'checkbox'" style="width: 90%; display: block; margin: 0px auto; margin-top:10px;">
                  <mat-label>{{col.title}}</mat-label>

                  <input *ngIf="col.type !== 'select' && col.type !== 'textarea' && col.type !== 'combo'" matInput type="{{col.type}}" class="tablefield" [(ngModel)]="row[col.data]" [disabled]="isDisabled(col)" (change)="onInputChange($event, col, row)"/>

                  <mat-select *ngIf="col.type === 'select'"  matInput class="tablefield" [(ngModel)]="row[col.data]" [disabled]="isDisabled(col)" (selectionChange)="onSelectChange($event, col, row)">
                    <mat-option *ngFor="let opt of col.options" [value]="opt.value">{{ opt.label }}</mat-option>
                  </mat-select>

                  <mat-select *ngIf="col.type === 'combo'" class="tablefield" [(ngModel)]="row[col.data]" [disabled]="isDisabled(col)" (selectionChange)="onSelectChange($event, col, row)">
                    <mat-option>
                      <ngx-mat-select-search (input)="onSearchChange(row, col, searchValue[col.data])" [(ngModel)]="searchValue[col.data]" placeholderLabel="" noEntriesFoundLabel="No data found"></ngx-mat-select-search>
                    </mat-option>
                    <mat-option *ngFor="let opt of col.options" [value]="opt.value">{{opt.label}}</mat-option>
                  </mat-select>

                </mat-form-field>
                <mat-checkbox *ngIf="col.type === 'checkbox'" matInput class="tablefield" [(ngModel)]="row[col.data]" [disabled]="isDisabled(col)" (change)="onCheckboxChange($event, col, row)"></mat-checkbox>
              </ng-template>
            </div>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="clickRow.emit(row)"></tr>
  </table>

  <mat-paginator
    *ngIf="pagination==='client'"
    [pageSizeOptions]="pageSizeOptions"
    showFirstLastButtons
    >
  </mat-paginator>

  <mat-paginator
    *ngIf="pagination==='server'"
    (page)="handlePageEvent($event)"
    [length]="paginatorLength"
    [pageSize]="pageSize"
    [pageSizeOptions]="pageSizeOptions"
    [pageIndex]="pageIndex"
    showFirstLastButtons
    >
  </mat-paginator>
